<script>
$(document).ready(function() {
  $('#delete').click( function(e) {
    if ( confirm('OK to delete this pub?') ) {
      $.post("[% c.uri_for('/pub/delete', pub.id) %]");
      window.location.replace('[% c.uri_for('/pub/list') %]');
    }
  });
});
</script>

[% 
  short_title = pub.title | truncate(30);
  title = 'View Pub &quot;' _ short_title _ '&quot;';
%]

<h1>[% title %]</h1>
<a class="btn" href="[% c.uri_for('/pub/edit_form', pub.id) %]">Edit</a>
<a class="btn" name="delete" id="delete">Delete</a>

<table class="table table-bordered">
  <tr>
    <th align="right">Title:</th>
    <td>[% pub.title %]</td>
  </tr>
  <tr>
    <th align="right">Journal:</th>
    <td>[% pub.journal %]</td>
  </tr>
  <tr>
    <th align="right">Year:</th>
    <td>[% pub.year %]</td>
  </tr>
  <tr>
    <th align="right">Authors:</th>
    <td>[% pub.authors %]</td>
  </tr>
  <tr>
    <th align="right">PubMed ID:</th>
    <td>[% pub.pubmed %]</td>
  </tr>
  <tr>
    <th align="right">URL:</th>
    <td>[% pub.url %]</td>
  </tr>
  <tr>
    <th align="right">Data:</th>
    <td>[% pub.data %]</td>
  </tr>
  <tr>
    <th align="right">Cover:</th>
    <td>[% pub.cover %]</td>
  </tr>
  <tr>
    <th align="right">PDF:</th>
    <td>[% IF pub.pdf %]<a href="[% c.uri_for('/pub/get_pdf/', pub.id) %]" class="btn">Get</a>[% ELSE %]NA[% END %]</td>
  </tr>
  <tr>
    <th align="right">Info 115:</th>
    <td>[% pub.info_115 %]</td>
  </tr>
</table>
</form>

<pre>[% USE dumper; dumper.dump(pub.pub_to_funding) %]</pre>
<h2>Funding</h2>
<table class="table">
  <tr>
    <th>Agency</th>
    <th>Funding</th>
  </tr>
  <tr>
    <td><a href="[% #c.uri_for('/agency/view', pub.funding.agency.id) %]">[% #pub.funding.agency.agency_name %]</a></td>
  </tr>
  <tr>
    <td><a href="[% #c.uri_for('/agency/view', pub.funding.id) %]">[% #pub.funding.title OR 'unknown' %]</a></td>
  </tr>
</table>
